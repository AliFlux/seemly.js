/*! Minified. Generated on 2015-09-08 */
(function(){"use strict";function a(a,b,c){!function(d){a[b]=a[c],a[c]=d}(a[b])}var b,c=0,d=1,e=2,f=3,g=4,h=5,i=6,j=7,k=8,l=9,m=10,n=11,o=12,p=13,q=14,r=15,s=16,t=17,u=18,v=19,w=20,x=21,y=22,z=23,A=24,B=25,C=26,D=27,E=28,F=29,G=30,H=function(a){var b=this;Object.keys(a).forEach(function(c){b[c]=a[c]})};H.prototype={toString:function(){return JSON.stringify(this)}};var I=function(a,b){this.old=a,this["new"]=b};I.prototype={contains:function(a){return a.length<this.length?a["new"]>=this["new"]&&a["new"]<this["new"]+this.length:!1},toString:function(){return this.length+" element subset, first mapping: old "+this.old+" â†’ new "+this["new"]}};var J=function(a){var b=[];return 1===a.nodeType&&(b.push(a.tagName),"string"==typeof a.className&&b.push(a.tagName+"."+a.className.replace(/ /g,".")),a.id&&b.push(a.tagName+"#"+a.id)),b},K=function(a){var b,c,d,e={},f={},g=Array.prototype.slice.call(a);return g.forEach(function(a){b=J(a),b.forEach(function(a){c=a in e,d=a in f,c||d?c&&(delete e[a],f[a]=!0):e[a]=!0})}),e},L=function(a,b){var c,d=K(a),e=K(b),f={};return Object.keys(d).forEach(function(){e[c]&&(f[c]=!0)}),f},M=function X(a,b,c,d,e){var f,g,h;if(!a||!b)return!1;if(a.nodeType!==b.nodeType)return!1;if(3===a.nodeType)return 3!==b.nodeType?!1:e?!0:a.data===b.data;if(a.nodeName!==b.nodeName)return!1;if(a.tagName===b.tagName){if(a.tagName in c)return!0;if(a.id&&a.id===b.id){var i=a.tagName+"#"+a.id;if(i in c)return!0}if(a.className&&a.className===b.className){var j=a.tagName+"."+a.className.replace(/ /g,".");if(j in c)return!0}if(d)return!0}return a.childNodes.length!==b.childNodes.length?!1:(g=Array.prototype.slice.call(a.childNodes).reverse(),h=Array.prototype.slice.call(b.childNodes).reverse(),e?g.every(function(a,b){return a.nodeName===h[b].nodeName}):(f=L(a.childNodes,b.childNodes),g.every(function(a,b){return X(a,h[b],f,!0,!0)})))},N=function(a){var b,c,d,e,f=a.cloneNode(!0);return 8!==a.nodeType&&3!==a.nodeType&&(b=Array.prototype.slice.call(a.querySelectorAll("textarea")),c=f.querySelectorAll("textarea"),b.forEach(function(a,b){c[b].value!==a.value&&(c[b].value=a.value)}),a.value&&a.value!==f.value&&(f.value=a.value),d=Array.prototype.slice.call(a.querySelectorAll("option")),e=f.querySelectorAll("option"),d.forEach(function(a,b){a.selected&&!e[b].selected?e[b].selected=!0:!a.selected&&e[b].selected&&(e[b].selected=!1)}),a.selected&&!f.selected?f.selected=!0:!a.selected&&f.selected&&(f.selected=!1)),f},O=function(a){var b={};return 3===a.nodeType?b[A]=a.data:8===a.nodeType?b[D]=a.data:(b[C]=a.nodeName,a.attributes&&a.attributes.length>0&&(b[B]=[],Array.prototype.slice.call(a.attributes).forEach(function(a){b[B].push([a.name,a.value])})),a.childNodes&&a.childNodes.length>0&&(b[E]=[],Array.prototype.slice.call(a.childNodes).forEach(function(a){b[E].push(O(a))})),a.value&&(b[z]=a.value),a.checked&&(b[F]=a.checked),a.selected&&(b[G]=a.selected)),b},P=function(a,b){var c;return a.hasOwnProperty(A)?c=document.createTextNode(a[A]):a.hasOwnProperty(D)?c=document.createComment(a[D]):("svg"===a[C]||b?(c=document.createElementNS("http://www.w3.org/2000/svg",a[C]),b=!0):c=document.createElement(a[C]),a[B]&&a[B].forEach(function(a){c.setAttribute(a[0],a[1])}),a[E]&&a[E].forEach(function(a){c.appendChild(P(a,b))}),a[z]&&(c.value=a[z]),a[F]&&(c.checked=a[F]),a[G]&&(c.selected=a[G])),c},Q=function(a,b,c,d){var e,f,g=0,h=[],i=Array.prototype.slice.call(a),j=Array.prototype.slice.call(b),k=Array.apply(null,new Array(a.length+1)).map(function(){return[]}),l=L(a,b),m=a.length===b.length;return m&&i.some(function(a,c){var d=J(a),e=J(b[c]);return d.length!==e.length?(m=!1,!0):(d.some(function(a,b){return a!==e[b]?(m=!1,!0):void 0}),m?void 0:!0)}),i.forEach(function(a,b){j.forEach(function(e,f){c[b]||d[f]||!M(a,e,l,m)?k[b+1][f+1]=0:(k[b+1][f+1]=k[b][f]?k[b][f]+1:1,k[b+1][f+1]>g&&(g=k[b+1][f+1],h=[b+1,f+1]))})}),0===g?!1:(e=[h[0]-g,h[1]-g],f=new I(e[0],e[1]),f.length=g,f)},R=function(a,b){return Array.apply(null,new Array(a)).map(function(){return b})},S=function(a,b,c){var d=R(a.childNodes.length,!0),e=R(b.childNodes.length,!0),f=0;return c.forEach(function(a){var b,c=a.old+a.length,g=a["new"]+a.length;for(b=a.old;c>b;b+=1)d[b]=f;for(b=a["new"];g>b;b+=1)e[b]=f;f+=1}),{gaps1:d,gaps2:e}},T=function(a,b){a=N(a),b=N(b);for(var c=a.childNodes,d=b.childNodes,e=R(c.length,!1),f=R(d.length,!1),g=[],h=!0,i=function(){return arguments[1]},j=function(a){e[h.old+a]=!0,f[h["new"]+a]=!0};h;)h=Q(c,d,e,f),h&&(g.push(h),Array.apply(null,new Array(h.length)).map(i).forEach(j));return g},U=function(a,b,c,d){if(0===c.length)return!1;var e,l,m,n,o,p,y,A,B,C=S(a,b,c),D=C.gaps1,E=D.length,F=C.gaps2,G=D.length,I=G>E?D:F;for(m=0;m<I.length;m+=1){if(D[m]===!0){if(y=a.childNodes[m],3===y.nodeType){if(3===b.childNodes[m].nodeType&&y.data!==b.childNodes[m].data){for(B=y;B.nextSibling&&3===B.nextSibling.nodeType;)if(B=B.nextSibling,b.childNodes[m].data===B.data){A=!0;break}if(!A)return o={},o[q]=f,o[r]=d.concat(m),o[s]=y.data,o[t]=b.childNodes[m].data,new H(o)}return o={},o[q]=j,o[r]=d.concat(m),o[z]=y.data,new H(o)}return o={},o[q]=h,o[r]=d.concat(m),o[u]=O(y),new H(o)}if(F[m]===!0)return y=b.childNodes[m],3===y.nodeType?(o={},o[q]=k,o[r]=d.concat(m),o[z]=y.data,new H(o)):(o={},o[q]=i,o[r]=d.concat(m),o[u]=O(y),new H(o));if(D[m]!==F[m]&&(p=c[D[m]],l=Math.min(p["new"],a.childNodes.length-p.length),l!==m)){for(e=!1,n=0;n<p.length;n+=1)a.childNodes[l+n].isEqualNode(a.childNodes[m+n])||(e=!0);if(e)return o={},o[q]=g,o[v]=p,o[w]=m,o[x]=l,o[r]=d,new H(o)}}return!1},V=function(){this.list=[]};V.prototype={list:!1,add:function(a){var b=this.list;a.forEach(function(a){b.push(a)})},forEach:function(a){this.list.forEach(a)}};var W=function(a,b){"undefined"==typeof a?a=!1:(c="add attribute",d="modify attribute",e="remove attribute",f="modify text element",g="relocate group",h="remove element",i="add element",j="remove text element",k="add text element",l="replace element",m="modify value",n="modify checked",o="modify selected",q="action",r="route",s="oldValue",t="newValue",u="element",v="group",w="from",x="to",y="name",z="value",A="text",B="attributes",C="nodeName",D="comment",E="childNodes",F="checked",G="selected"),"undefined"==typeof b&&(b=10),this.debug=a,this.diffcap=b};W.prototype={diff:function(a,c){return b=0,a=N(a),c=N(c),this.debug&&(this.t1Orig=O(a),this.t2Orig=O(c)),this.tracker=new V,this.findDiffs(a,c)},findDiffs:function(a,c){var d;do{if(this.debug&&(b+=1,b>this.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));d=this.findFirstDiff(a,c,[]),d&&(d.length||(d=[d]),this.tracker.add(d),this.apply(a,d))}while(d);return this.tracker.list},findFirstDiff:function(a,b,c){var d=this.findOuterDiff(a,b,c);if(d.length>0)return d;var e=this.findInnerDiff(a,b,c);return e&&("undefined"==typeof e.length&&(e=[e]),e.length>0)?e:!1},findOuterDiff:function(a,b,f){var g;if(a.nodeName!==b.nodeName)return g={},g[q]=l,g[s]=O(a),g[t]=O(b),g[r]=f,[new H(g)];var h=Array.prototype.slice,i=function(a,b){return a.name>b.name},j=a.attributes?h.call(a.attributes).sort(i):[],k=b.attributes?h.call(b.attributes).sort(i):[],u=function(a,b){var c,d=b.length;for(c=0;d>c;c+=1)if(b[c].name===a.name)return c;return-1},v=[];if((a.value||b.value)&&a.value!==b.value&&"OPTION"!==a.nodeName&&(g={},g[q]=m,g[s]=a.value,g[t]=b.value,g[r]=f,v.push(new H(g))),(a.checked||b.checked)&&a.checked!==b.checked&&(g={},g[q]=n,g[s]=a.checked,g[t]=b.checked,g[r]=f,v.push(new H(g))),j.forEach(function(a){var b,c=u(a,k);if(-1===c)return b={},b[q]=e,b[r]=f,b[y]=a.name,b[z]=a.value,v.push(new H(b)),v;var g=k.splice(c,1)[0];a.value!==g.value&&(b={},b[q]=d,b[r]=f,b[y]=a.name,b[s]=a.value,b[t]=g.value,v.push(new H(b)))}),a.attributes||a.data===b.data||(g={},g[q]=p,g[r]=f,g[s]=a.data,g[t]=b.data,v.push(new H(g))),v.length>0)return v;if(k.forEach(function(a){var b;b={},b[q]=c,b[r]=f,b[y]=a.name,b[z]=a.value,v.push(new H(b))}),(a.selected||b.selected)&&a.selected!==b.selected){if(v.length>0)return v;g={},g[q]=o,g[s]=a.selected,g[t]=b.selected,g[r]=f,v.push(new H(g))}return v},findInnerDiff:function(a,b,c){var d,e,g,l,m,n,o,p=T(a,b),v=p.length;if(0===v&&3===a.nodeType&&3===b.nodeType&&a.data!==b.data)return o={},o[q]=f,o[s]=a.data,o[t]=b.data,o[r]=c,new H(o);if(2>v)for(l=Math.max(a.childNodes.length,b.childNodes.length),g=0;l>g;g+=1){if(m=a.childNodes[g],n=b.childNodes[g],m&&!n)return 3===m.nodeType?(o={},o[q]=j,o[r]=c.concat(g),o[z]=m.data,new H(o)):(o={},o[q]=h,o[r]=c.concat(g),o[u]=O(m),new H(o));if(n&&!m)return 3===n.nodeType?(o={},o[q]=k,o[r]=c.concat(g),o[z]=n.data,new H(o)):(o={},o[q]=i,o[r]=c.concat(g),o[u]=O(n),new H(o));if((3!==m.nodeType||3!==n.nodeType)&&(e=this.findOuterDiff(m,n,c.concat(g)),e.length>0))return e;if(d=this.findInnerDiff(m,n,c.concat(g)))return d}return this.findFirstInnerDiff(a,b,p,c)},findFirstInnerDiff:U,apply:function(a,b){var c=this,d=b;return"undefined"==typeof d.length&&(d=[d]),0===d.length?!0:(d.forEach(function(b){return c.applyDiff(a,b)?void 0:!1}),!0)},getFromRoute:function(a,b){b=b.slice();for(var c,d=a;b.length>0;){if(!d.childNodes)return!1;c=b.splice(0,1)[0],d=d.childNodes[c]}return d},textDiff:function(){arguments[0].data=arguments[3]},applyDiff:function(a,b){var A,B,C,D,E,F,G,H,I,J=this.getFromRoute(a,b[r]);switch(b[q]){case c:if(!J||!J.setAttribute)return!1;J.setAttribute(b[y],b[z]);break;case d:if(!J||!J.setAttribute)return!1;J.setAttribute(b[y],b[t]);break;case e:if(!J||!J.removeAttribute)return!1;J.removeAttribute(b[y]);break;case f:if(!J||3!==J.nodeType)return!1;this.textDiff(J,J.data,b[s],b[t]);break;case m:if(!J||"undefined"==typeof J.value)return!1;J.value=b[t];break;case p:if(!J||"undefined"==typeof J.data)return!1;J.data=b[t];break;case n:if(!J||"undefined"==typeof J.checked)return!1;J.checked=b[t];break;case o:if(!J||"undefined"==typeof J.selected)return!1;J.selected=b[t];break;case l:A=P(b[t]),J.parentNode.replaceChild(A,J);break;case g:if(D=b[v],E=b[w],F=b[x],B=J.childNodes[F+D.length],F>E)for(I=0;I<D.length;I+=1)G=J.childNodes[E],J.insertBefore(G,B);else for(B=J.childNodes[F],I=0;I<D.length;I+=1)G=J.childNodes[E+I],J.insertBefore(G,B);break;case h:J.parentNode.removeChild(J);break;case i:C=b[r].slice(),H=C.splice(C.length-1,1)[0],J=this.getFromRoute(a,C),A=P(b[u]),H>=J.childNodes.length?J.appendChild(A):(B=J.childNodes[H],J.insertBefore(A,B));break;case j:if(!J||3!==J.nodeType)return!1;J.parentNode.removeChild(J);break;case k:if(C=b[r].slice(),H=C.splice(C.length-1,1)[0],A=document.createTextNode(b[z]),J=this.getFromRoute(a,C),!J||!J.childNodes)return!1;H>=J.childNodes.length?J.appendChild(A):(B=J.childNodes[H],J.insertBefore(A,B));break;default:console.log("unknown action")}return!0},undo:function(a,b){b=b.slice();var c=this;b.length||(b=[b]),b.reverse(),b.forEach(function(b){c.undoDiff(a,b)})},undoDiff:function(b,r){switch(r[q]){case c:r[q]=e,this.applyDiff(b,r);break;case d:a(r,s,t),this.applyDiff(b,r);break;case e:r[q]=c,this.applyDiff(b,r);break;case f:a(r,s,t),this.applyDiff(b,r);break;case m:a(r,s,t),this.applyDiff(b,r);break;case p:a(r,s,t),this.applyDiff(b,r);break;case n:a(r,s,t),this.applyDiff(b,r);break;case o:a(r,s,t),this.applyDiff(b,r);break;case l:a(r,s,t),this.applyDiff(b,r);break;case g:a(r,w,x),this.applyDiff(b,r);break;case h:r[q]=i,this.applyDiff(b,r);break;case i:r[q]=h,this.applyDiff(b,r);break;case j:r[q]=k,this.applyDiff(b,r);break;case k:r[q]=j,this.applyDiff(b,r);break;default:console.log("unknown action")}}},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=W),exports.diffDOM=W):this.diffDOM=W}).call(this);